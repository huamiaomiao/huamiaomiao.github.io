# 计算属性与侦听器

## computed

```vue
<script setup>
import { ref, computed } from "vue";
const first = ref("Ada"),
  last = ref("Lovelace");
const full = computed(() => `${first.value} ${last.value}`);
</script>
<template>
  <p>{{ full }}</p>
</template>
```

## watch

```vue
<script setup>
import { ref, watch } from "vue";
const q = ref("");
watch(
  q,
  (n, o) => {
    console.log("搜索变更：", o, "→", n);
  },
  { flush: "post" }
);
</script>
```

## watchEffect

```js
import { ref, watchEffect } from "vue";
const x = ref(0);
watchEffect(() => {
  // 自动收集依赖
  console.log("x 变了：", x.value);
});
```

## 练习

- 使用 `computed` 做价格格式化；`watch` 做防抖搜索。\*\*\*

---

## 知识拓展

- 计算属性缓存与依赖

```vue
<script setup>
import { ref, computed } from "vue";
const a = ref(1),
  b = ref(2);
let runs = 0;
const sum = computed(() => {
  runs++;
  return a.value + b.value;
});
</script>
<template>
  <p>sum: {{ sum }}（计算执行次数：{{ runs }}）</p>
</template>
```

- watch 深度与立即触发

```js
watch(
  obj,
  (n, o) => {
    /* 深比较 */
  },
  { deep: true, immediate: true }
);
```

- 防抖/节流侦听

```js
let tid;
watch(search, (q) => {
  clearTimeout(tid);
  tid = setTimeout(() => doQuery(q), 300);
});
```
