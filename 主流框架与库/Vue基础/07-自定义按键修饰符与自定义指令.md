# 自定义按键修饰符与自定义指令

> 目标：在需要时扩展事件按键语义；学会编写简单的指令来操作 DOM。

## 自定义按键修饰符（Vue2 风格）

```js
Vue.config.keyCodes.f2 = 113; // 现在可用 @keyup.f2 捕获
```

Vue3 推荐直接在代码中判断 `e.key`/`e.code`，或封装成方法。

## 自定义指令（Vue3）

```js
// 自动聚焦
const vFocus = {
  mounted(el) {
    el.focus();
  },
};

export default {
  directives: { focus: vFocus },
};
```

```html
<input v-focus />
```

生命周期钩子：

- `created`（beforeMount 之前立即调用）
- `beforeMount` / `mounted`
- `beforeUpdate` / `updated`
- `beforeUnmount` / `unmounted`

## 示例：点击外部关闭

```js
function onClickOutside(el, cb) {
  const handler = (e) => !el.contains(e.target) && cb(e);
  document.addEventListener("click", handler);
  return () => document.removeEventListener("click", handler);
}

const vClickOutside = {
  mounted(el, { value }) {
    el._off = onClickOutside(el, value);
  },
  unmounted(el) {
    el._off && el._off();
  },
};
```

```html
<div v-click-outside="hide">下拉菜单</div>
```

## 练习建议

- 指令：`v-sticky`（滚动到顶后吸顶）
- 指令：`v-copy`（点击复制文本到剪贴板）
