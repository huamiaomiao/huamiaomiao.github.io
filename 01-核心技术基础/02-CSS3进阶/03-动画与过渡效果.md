# 动画与过渡效果（Transitions & Animations）

> 目标：掌握过渡与关键帧动画的使用、性能优化与常见交互动画模式。

## 过渡（transition）

过渡用于元素状态变化（如 hover、class 切换）时的平滑动画。

关键属性：

- `transition-property`: 参与过渡的属性
- `transition-duration`: 时长
- `transition-timing-function`: 缓动（`ease`、`linear`、`cubic-bezier()`、`steps()`）
- `transition-delay`: 延迟

常用组合：

```css
.btn {
  background: #0969da;
  color: #fff;
  padding: 10px 16px;
  border-radius: 8px;
  transform: translateY(0);
  transition: transform 200ms ease, box-shadow 200ms ease, background 200ms ease;
}
.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
  background: #0a63c9;
}
```

建议仅对“复合属性”做过渡（如 `opacity`、`transform`），避免频繁触发布局与重绘。

## 关键帧动画（animation）

用于元素独立的时间轴动画，不依赖状态切换。

关键属性：

- `@keyframes`：关键帧定义
- `animation-name / duration / timing-function / delay`
- `animation-iteration-count`：次数或 `infinite`
- `animation-direction`：`normal` | `reverse` | `alternate` | `alternate-reverse`
- `animation-fill-mode`：`none` | `forwards` | `backwards` | `both`
- `animation-play-state`：`running` | `paused`

例：Loading 旋转

```html
<div class="spinner"></div>
```

```css
.spinner {
  width: 28px;
  height: 28px;
  border: 3px solid #d0d7de;
  border-top-color: #0969da;
  border-radius: 50%;
  animation: spin 800ms linear infinite;
}
@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}
```

例：内容显隐过渡（高度+透明）

```html
<div class="panel" data-open="false">
  <p>可折叠内容</p>
  <p>......</p>
  <p>......</p>
  <p>......</p>
</div>
```

```css
.panel {
  overflow: hidden;
  max-height: 0;
  opacity: 0;
  transition: max-height 300ms ease, opacity 200ms ease;
}
.panel[data-open="true"] {
  max-height: 300px; /* 估值或用 JS 计算 scrollHeight */
  opacity: 1;
}
```

## 缓动函数（timing functions）

- 预设：`ease`、`ease-in`、`ease-out`、`ease-in-out`、`linear`
- 自定义：`cubic-bezier(p1x,p1y,p2x,p2y)`，如 `cubic-bezier(.2,.7,.3,1)`
- 阶梯：`steps(n, start|end)`，如逐帧数字翻页

## 性能优化与合成层

- 优先使用 `transform` 与 `opacity`（由合成器处理，避免重排/重绘）
- 用 `will-change: transform, opacity;` 提示浏览器可能的变化（谨慎使用，避免长期占用内存）
- 避免过多并发动画，特别是高频率/大面积的非合成属性
- 在低端设备上降低帧率/时长，减少动画数量

## 常见交互模式

- 悬浮态/按压态：按钮、卡片提升与阴影过渡
- 折叠/展开：高度+透明或 `scaleY` 组合
- 进场/退场：列表项淡入上移、模态弹层缩放+淡入
- 骨架屏/占位：背景渐变移动（shimmer）

例：卡片浮起

```css
.card {
  transform: translateY(0);
  box-shadow: 0 0 0 rgba(0, 0, 0, 0);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
}
```

## 练习建议

- 将按钮/卡片/导航的状态切换统一为一致的过渡风格
- 为列表项添加“逐个错位淡入”的进入动画
- 制作一个可复用的“折叠面板”组件，兼顾性能

---

## 知识拓展

- 延时阶梯（staggered）进入

```css
.item {
  opacity: 0;
  transform: translateY(6px);
}
.item.show {
  animation: fadeUp 0.3s ease forwards;
}
.item.show:nth-child(2) {
  animation-delay: 0.06s;
}
.item.show:nth-child(3) {
  animation-delay: 0.12s;
}
@keyframes fadeUp {
  to {
    opacity: 1;
    transform: none;
  }
}
```

- 滚动触发的淡入（IntersectionObserver）

```js
const io = new IntersectionObserver(
  (entries) => {
    entries.forEach((e) => {
      if (e.isIntersecting) e.target.classList.add("show");
    });
  },
  { threshold: 0.1 }
);
document.querySelectorAll(".item").forEach((el) => io.observe(el));
```
