# HTML5 基础：响应式布局

> 核心理念、常用模式与可复制代码片段，覆盖媒体查询、弹性/网格、流式媒体、容器查询与流式排版。

---

## 1. 响应式的基础理念

- 移动优先（Mobile First）：优先适配小屏，在较大屏幕上逐步增强（使用 `min-width` 断点）。
- 流式布局（Fluid）：宽度/间距尽量用相对单位（`%`、`vw/vh`、`em/rem`、`clamp()`）。
- 弹性媒体（Flexible Media）：图片/视频不超出容器（`max-width: 100%`）。
- 渐进增强：小屏优先 + 逐步添加布局/交互，不依赖 JS 也能用。

---

## 2. 视口与单位

- 视口设置（移动端必备）

```html
<meta name="viewport" content="width=device-width,initial-scale=1" />
```

- 常用相对单位
  - `%`：相对父元素尺寸
  - `vw/vh`：相对视口宽/高
  - `em/rem`：相对字体尺寸（`rem` 相对根元素）
  - `clamp(min, preferred, max)`：在区间内流式变化

示例：流式字号与容器宽度

```css
:root {
  --space: 1rem;
}
body {
  font-size: clamp(14px, 1.6vw, 18px);
  margin: 0;
}
.container {
  width: min(92vw, 1200px);
  margin-inline: auto;
  padding-inline: var(--space);
}
```

---

## 3. 媒体查询（Media Queries）

- 推荐：移动优先断点（`min-width`）
- 常用断点（仅示例，按设计实际调整）：
  - 480px（小型手机）
  - 768px（平板）
  - 1024px（小笔电）
  - 1280px+（桌面）

示例：两列 → 三列

```css
.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}
@media (min-width: 768px) {
  .grid {
    grid-template-columns: 1fr 1fr 1fr;
  }
}
```

---

## 4. 弹性盒（Flexbox）与常见模式

适合一维布局（行或列）。常用于导航、工具条、卡片列表。

```css
.toolbar {
  display: flex;
  gap: 0.75rem;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap; /* 允许小屏换行 */
}
.nav {
  display: flex;
  gap: 1rem;
}
/* 小屏堆叠，较大屏横排 */
@media (min-width: 768px) {
  .toolbar {
    flex-wrap: nowrap;
  }
}
```

常见响应式导航（无 JS 版本，使用 `<details>`）

```html
<details class="nav-wrap">
  <summary>菜单</summary>
  <nav class="nav">
    <a href="/">首页</a>
    <a href="/blog">博客</a>
    <a href="/about">关于</a>
  </nav>
</details>

<style>
  .nav-wrap {
    border: 1px solid #eee;
    padding: 0.5rem;
  }
  .nav {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  @media (min-width: 768px) {
    .nav-wrap {
      display: block;
      border: 0;
      padding: 0;
    }
    .nav-wrap > summary {
      display: none;
    }
    .nav {
      flex-direction: row;
      gap: 1rem;
    }
  }
</style>
```

---

## 5. 网格（CSS Grid）与自适应卡片

适合二维布局。结合 `auto-fit/auto-fill` + `minmax()` 轻松实现自适应网格。

```css
.card-grid {
  display: grid;
  gap: 1rem;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}
.card {
  border: 1px solid #eee;
  border-radius: 0.5rem;
  padding: 1rem;
  background: #fff;
}
```

圣杯/两栏布局（Grid 版本）

```css
.layout {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1rem;
}
@media (min-width: 1024px) {
  .layout {
    grid-template-columns: 240px 1fr; /* 侧栏 + 主区 */
  }
}
```

---

## 6. 容器查询（Container Queries，现代浏览器）

当组件宽度变化时改变其内部布局，而非依赖视口。

```html
<section class="card-list">
  <article class="card">...</article>
  <article class="card">...</article>
</section>

<style>
  .card-list {
    container-type: inline-size;
  } /* 定义容器 */
  .card {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }
  @container (min-width: 520px) {
    .card {
      grid-template-columns: 160px 1fr;
    } /* 容器足够宽时启用两列 */
  }
</style>
```

---

## 7. 响应式图片与媒体

- 基础约束：图片不溢出容器

```css
img,
video {
  max-width: 100%;
  height: auto;
}
```

- `srcset`/`sizes`（按设备 DPR/布局宽度选择资源）

```html
<img
  src="img-800.jpg"
  srcset="img-400.jpg 400w, img-800.jpg 800w, img-1200.jpg 1200w"
  sizes="(min-width: 1024px) 800px, (min-width: 768px) 600px, 92vw"
  alt="示例图片"
/>
```

- `<picture>`（艺术裁剪/格式切换）与懒加载

```html
<picture>
  <source type="image/avif" srcset="hero.avif" />
  <source type="image/webp" srcset="hero.webp" />
  <img src="hero.jpg" alt="横幅" loading="lazy" />
</picture>
```

---

## 8. 流式排版与间距

使用 `clamp()` 让字号/间距随视口平滑变更，并设置上/下限。

```css
:root {
  --space-1: clamp(8px, 1.2vw, 12px);
  --space-2: clamp(12px, 1.6vw, 16px);
  --space-3: clamp(16px, 2vw, 24px);
}
h1 {
  font-size: clamp(22px, 3vw, 34px);
}
p {
  line-height: 1.65;
  margin-block: var(--space-2);
}
.section {
  padding-block: var(--space-3);
}
```

---

## 9. 交互与偏好媒体特性

```css
/* 深色模式 */
@media (prefers-color-scheme: dark) {
  :root {
    color-scheme: dark;
  }
  body {
    background: #111;
    color: #eee;
  }
}
/* 减少动效（可访问性） */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.001ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.001ms !important;
  }
}
/* 触控目标：更大点击区域 */
button,
a.button {
  min-height: 44px;
  padding: 0.6rem 1rem;
}
```

---

## 10. 性能与小技巧

- 优先加载关键样式（Critical CSS），其余按需/延迟加载。
- 使用 `content-visibility: auto;` 提升大量卡片/长列表渲染性能。
- 为图片提供合理的占位（`aspect-ratio` 或 `width/height`）避免布局抖动（CLS）。

```css
.card {
  content-visibility: auto;
  contain-intrinsic-size: 300px 200px;
}
.media {
  aspect-ratio: 16 / 9;
  background: #f6f6f6;
}
```

---

## 11. 快速检查清单（Checklist）

- [ ] 已设置 `meta viewport` 且采用移动优先断点
- [ ] 主要尺寸/间距使用相对单位与 `clamp()`
- [ ] 图片/视频 `max-width:100%` + 合理的 `srcset/sizes`
- [ ] 合理选择 Flex（单轴）与 Grid（双轴），避免滥用栅格
- [ ] 常见模式（导航/卡片/两栏）在断点切换时无跳跃
- [ ] 考虑深色模式与减少动效偏好
- [ ] 组件内使用容器查询（如支持）增强复用
- [ ] 大量内容使用 `content-visibility` 或分页/虚拟化

---

## 知识拓展

- `clamp()` 与 `min()` / `max()` 组合的响应式尺寸体系

```css
:root {
  --space: clamp(8px, 1.2vw, 16px);
  --radius: clamp(8px, 0.8vw, 12px);
}
.card {
  padding: var(--space);
  border-radius: var(--radius);
}
```

- CSS 容器查询的渐进增强策略

```css
.panel {
  padding: 12px;
}
@supports (container-type: inline-size) {
  .wrap {
    container-type: inline-size;
  }
  @container (min-width: 520px) {
    .panel {
      padding: 20px;
      display: grid;
      grid-template-columns: 160px 1fr;
      gap: 12px;
    }
  }
}
```

- 响应式表格（小屏转为“卡片”）

```css
table {
  width: 100%;
  border-collapse: collapse;
}
th,
td {
  border: 1px solid #e5e7eb;
  padding: 8px;
  text-align: left;
}
@media (max-width: 640px) {
  table,
  thead,
  tbody,
  th,
  td,
  tr {
    display: block;
  }
  thead {
    display: none;
  }
  tr {
    margin-bottom: 10px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
  }
  td {
    border: 0;
    display: grid;
    grid-template-columns: 120px 1fr;
    gap: 8px;
  }
  td::before {
    content: attr(data-label);
    color: #6b7280;
  }
}
```
