# HTML5 基础：表单与交互元素

> 实用导向的表单语义、可用性与校验清单，附常用代码片段。

---

## 1. 表单语义与结构

- 使用语义元素组织表单
  - `form`：表单容器（`action`、`method`、`novalidate`）
  - `fieldset`/`legend`：分组与分组标题
  - `label[for]`：显式关联控件；或将控件放在 `label` 内形成隐式关联
  - 表单控件：`input`/`textarea`/`select`/`button`

示例：

```html
<form id="contactForm" method="post">
  <fieldset>
    <legend>联系信息</legend>

    <label for="name">姓名</label>
    <input id="name" name="name" required />

    <label for="email">邮箱</label>
    <input id="email" name="email" type="email" required />
  </fieldset>

  <button type="submit">提交</button>
</form>
```

可访问性要点：

- 始终提供可见的 `label`（不要用 `placeholder` 代替标签）
- 分组复杂控件（日期、地址）时使用 `fieldset/legend`
- 错误提示与控件关联（`aria-describedby` 或就近放置）

---

## 2. 常用 input 类型与属性

- 类型：`text`、`email`、`url`、`tel`、`password`、`number`、`date`、`time`、`datetime-local`、`month`、`week`、`color`、`range`、`file`、`checkbox`、`radio`、`search`
- 属性与提示
  - `required`、`min`、`max`、`step`
  - `pattern`（正则校验）/ `maxlength` / `minlength`
  - `placeholder`（提示，不是标签）
  - `autocomplete`（如 `email`、`tel`、`one-time-code`）
  - `inputmode`（移动端键盘：`numeric`/`decimal`/`tel`/`email`）
  - `enterkeyhint`（虚拟键盘回车键文案）
  - `multiple`（文件/邮箱等允许多选）

示例：手机号与验证码

```html
<label for="tel">手机号</label>
<input
  id="tel"
  name="tel"
  type="tel"
  inputmode="numeric"
  pattern="^1\\d{10}$"
  autocomplete="tel"
  required
/>

<label for="otp">验证码</label>
<input
  id="otp"
  name="otp"
  inputmode="numeric"
  autocomplete="one-time-code"
  minlength="4"
  maxlength="6"
/>
```

---

## 3. 原生约束校验与自定义错误

浏览器提供 Constraint Validation API：

- `checkValidity()`：返回布尔，触发原生错误提示
- `reportValidity()`：与上类似，但一定显示提示
- `setCustomValidity(message)`：设置/清除自定义错误（传空字符串可清除）
- `validity` 对象：`valueMissing`/`typeMismatch`/`patternMismatch` 等

示例：提交前统一校验

```html
<form id="signupForm" novalidate>
  <label>邮箱 <input id="mail" type="email" required /></label>
  <label>密码 <input id="pwd" type="password" minlength="8" required /></label>
  <button>注册</button>
</form>
<script>
  const form = document.getElementById("signupForm");
  form.addEventListener("submit", (e) => {
    if (!form.checkValidity()) {
      e.preventDefault();
      form.reportValidity();
    }
  });
</script>
```

示例：自定义错误信息

```html
<input id="age" type="number" min="0" max="130" required />
<script>
  const age = document.getElementById("age");
  age.addEventListener("input", () => {
    if (age.validity.rangeUnderflow) {
      age.setCustomValidity("年龄不能小于 0");
    } else if (age.validity.rangeOverflow) {
      age.setCustomValidity("年龄太大啦");
    } else {
      age.setCustomValidity("");
    }
  });
</script>
```

---

## 4. FormData 与提交

原生提交：

- `method="get|post"`，`enctype="application/x-www-form-urlencoded|multipart/form-data|text/plain"`
- 文件上传需要 `multipart/form-data`

JS 提交（推荐与 fetch 配合）：

```html
<form id="profileForm">
  <input name="username" required />
  <input name="avatar" type="file" accept="image/*" />
  <button>保存</button>
  <output id="msg"></output>
  <script>
    const form = document.getElementById("profileForm");
    const msg = document.getElementById("msg");
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      try {
        const res = await fetch("/api/profile", { method: "POST", body: fd });
        if (!res.ok) throw new Error("网络错误");
        msg.textContent = "保存成功";
      } catch (err) {
        msg.textContent = "提交失败：" + err.message;
      }
    });
  </script>
</form>
```

---

## 5. 选择器与可访问性

- `label[for]`/隐式 label，提高命中面积与读屏器可读性
- `aria-describedby` 关联说明与错误区域
- 禁止仅靠颜色区分状态；错误/成功信息配合文本与图标
- 按键支持：回车提交、Esc 取消、Tab 顺序合理

示例：错误提示关联

```html
<label for="email2">邮箱</label>
<input id="email2" type="email" aria-describedby="email2-err" required />
<div id="email2-err" role="alert" style="color:#d21">请输入有效邮箱</div>
```

---

## 6. 交互元素与增强

- `datalist`：输入提示列表（非严格选择）

```html
<label for="city">城市</label>
<input id="city" name="city" list="cities" />
<datalist id="cities">
  <option value="北京" />
  <option value="上海" />
  <option value="深圳" />
</datalist>
```

- `details/summary`：可折叠区域

```html
<details>
  <summary>高级设置</summary>
  <label><input type="checkbox" /> 启用调试</label>
</details>
```

- `dialog`：原生对话框

```html
<button id="open">打开</button>
<dialog id="dlg">
  <form method="dialog">
    <p>已保存</p>
    <button>关闭</button>
  </form>
</dialog>
<script>
  open.onclick = () => dlg.showModal();
</script>
```

- 输入法与移动端优化
  - 数字输入：`type="tel"` + `inputmode="numeric"` 更通用
  - 日期/时间在不同平台控件差异较大，必要时使用成熟组件

---

## 7. 安全与体验

- 防止 XSS：对输出做转义；后端严格校验；避免将用户输入拼接为 HTML
- CSRF：表单跨站提交需配合 CSRF token 与同源策略
- 自动完成与密码管理器：合理设置 `autocomplete`，避免与安全策略冲突
- 错误信息友好明确，但避免泄露敏感校验规则

---

## 8. 快速检查清单（Checklist）

- [ ] 所有控件都有可见 `label` 并正确关联
- [ ] 使用合适的 `input[type]` 与属性（`required/min/max/step/pattern`）
- [ ] 原生校验 + 自定义错误信息组合
- [ ] 表单分组使用 `fieldset/legend`
- [ ] 合理设置 `autocomplete`/`inputmode`/`enterkeyhint`
- [ ] 错误提示与控件用 `aria-describedby` 关联
- [ ] 提交过程有状态反馈与失败重试
- [ ] 文件上传与 `FormData` 正确处理

---

## 知识拓展

- 可访问的校验摘要（表单顶部统一提示）

```html
<form id="order" novalidate>
  <div id="form-errors" role="alert" aria-live="polite"></div>
  <label>收件人 <input id="name2" required /></label>
  <label>邮箱 <input id="email3" type="email" required /></label>
  <button>下单</button>
</form>
<script>
  const form = document.getElementById("order");
  const errors = document.getElementById("form-errors");
  form.addEventListener("submit", (e) => {
    errors.textContent = "";
    if (!form.checkValidity()) {
      e.preventDefault();
      const list = [];
      if (!name2.checkValidity()) list.push("请填写收件人");
      if (!email3.checkValidity()) list.push("邮箱格式不正确");
      errors.innerHTML = "<ul><li>" + list.join("</li><li>") + "</li></ul>";
      form.reportValidity();
    }
  });
</script>
```

- 表单自动保存草稿

```html
<textarea id="draft" placeholder="自动保存……"></textarea>
<script>
  const key = "post:draft";
  const el = document.getElementById("draft");
  el.value = localStorage.getItem(key) || "";
  el.addEventListener("input", () => localStorage.setItem(key, el.value));
</script>
```
